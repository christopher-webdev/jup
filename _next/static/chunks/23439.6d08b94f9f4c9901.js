"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23439],{23439:function(e,t,n){n.r(t),n.d(t,{INITIAL_ORDER_INFO:function(){return se},INITIAL_POSITION_INFO:function(){return ue},default:function(){return ce}});var i=n(70107),r=n(54423),a=n(63956),o=n(27195),l=n(97620),s=n(8857),u=n.n(s),d=n(8473),c=n(4707),f=n(93981),m=n(55766),g=function(e,t,n){if(!m.jU)return[t,function(){}];var i=(0,f.useState)((function(){try{var r=sessionStorage.getItem(e);return"string"!==typeof r?(sessionStorage.setItem(e,n?String(t):JSON.stringify(t)),t):n?r:JSON.parse(r||"null")}catch(i){return t}})),r=i[0],a=i[1];return(0,f.useEffect)((function(){try{var t=n?String(r):JSON.stringify(r);sessionStorage.setItem(e,t)}catch(i){}})),[r,a]},p=n(10496),x=n(24201),v=n(72215),h=n(99438),w=n(23933),b=n(27177),P=n(25224),j=n(65558),y=n.n(j),C=n(13838),Z=n(39268),S=n.n(Z),N=n(13215),V=n(85394),k=n(13170),L=n(94223),I=n(13486),F=n(65895),_=n(7744),T=n(64508),M=n.n(T),U=n(71130),O=n(3561),D=n(41264),E=n(14640),q=n(24684),A=n(29541),B=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,r=void 0===i?8:i,a=e.fill,o=void 0===a?"rgba(255, 87, 87, 1)":a,l=e.className;return(0,A.jsx)("svg",{width:n,height:r,className:l,viewBox:"0 0 16 8",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,A.jsx)("path",{d:"M1.30473 0.195262C1.04438 -0.0650874 0.622268 -0.0650874 0.361919 0.195262C0.101569 0.455612 0.101569 0.877722 0.361919 1.13807L3.6227 4.39886C3.74166 4.51785 3.85752 4.63373 3.96366 4.72384C4.08023 4.8228 4.22816 4.92918 4.4213 4.99193C4.68909 5.07894 4.97755 5.07894 5.24535 4.99193C5.43849 4.92918 5.58642 4.8228 5.70298 4.72384C5.80913 4.63373 5.92498 4.51785 6.04394 4.39887L7.88381 2.55899C8.0236 2.4192 8.10045 2.34308 8.1599 2.29261L8.16666 2.28694L8.17341 2.29261C8.23286 2.34308 8.30971 2.4192 8.4495 2.55898L12.5572 6.66667H9.49999C9.1318 6.66667 8.83332 6.96514 8.83332 7.33333C8.83332 7.70152 9.1318 8 9.49999 8H14.1667C14.5348 8 14.8333 7.70152 14.8333 7.33333V2.66667C14.8333 2.29848 14.5348 2 14.1667 2C13.7985 2 13.5 2.29848 13.5 2.66667V5.72386L9.37727 1.60114C9.25832 1.48215 9.14246 1.36627 9.03631 1.27616C8.91975 1.1772 8.77182 1.07082 8.57868 1.00807C8.31089 0.921056 8.02242 0.921056 7.75463 1.00807C7.56149 1.07082 7.41356 1.1772 7.297 1.27616C7.19086 1.36626 7.07502 1.48213 6.95607 1.60111L5.11616 3.44102C4.97638 3.5808 4.89953 3.65692 4.84008 3.70739L4.83332 3.71306L4.82657 3.70739C4.76712 3.65692 4.69026 3.5808 4.55048 3.44102L1.30473 0.195262Z",fill:o})})},R=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,r=void 0===i?8:i,a=e.fill,o=void 0===a?"rgba(39, 174, 96, 1)":a,l=e.className;return(0,A.jsx)("svg",{width:n,height:r,className:l,viewBox:"0 0 16 8",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,A.jsx)("path",{d:"M10 0C9.63183 0 9.33335 0.298477 9.33335 0.666667C9.33335 1.03486 9.63183 1.33333 10 1.33333H13.0572L8.94953 5.44102C8.80974 5.5808 8.73289 5.65692 8.67344 5.70739L8.66669 5.71306L8.65993 5.70739C8.60048 5.65692 8.52363 5.5808 8.38384 5.44101L6.54397 3.60114C6.42502 3.48216 6.30915 3.36626 6.20301 3.27616C6.08645 3.1772 5.93852 3.07082 5.74538 3.00807C5.47758 2.92106 5.18912 2.92106 4.92133 3.00807C4.72819 3.07082 4.58026 3.1772 4.46369 3.27616C4.35755 3.36627 4.2417 3.48215 4.12274 3.60113L0.861949 6.86193C0.6016 7.12228 0.6016 7.54439 0.861949 7.80474C1.1223 8.06509 1.54441 8.06509 1.80476 7.80474L5.05051 4.55899C5.19029 4.4192 5.26715 4.34308 5.3266 4.29261L5.33335 4.28694L5.34011 4.29261C5.39956 4.34308 5.47641 4.4192 5.6162 4.55898L7.45608 6.39887C7.57504 6.51786 7.69089 6.63373 7.79703 6.72384C7.91359 6.8228 8.06152 6.92918 8.25466 6.99193C8.52246 7.07894 8.81092 7.07894 9.07871 6.99193C9.27185 6.92918 9.41978 6.8228 9.53635 6.72384C9.64249 6.63373 9.75834 6.51785 9.87731 6.39886L14 2.27614V5.33333C14 5.70152 14.2985 6 14.6667 6C15.0349 6 15.3334 5.70152 15.3334 5.33333V0.666667C15.3334 0.298477 15.0349 0 14.6667 0H10Z",fill:o})})},H=n(25546),W=n(83962),G=n(6397),K=n(31900),z=n(21039),Y=n(38756),J=n(4012),$=n(56720),Q=n(45009),X=n(96404),ee=n(69825),te=n(51232),ne=n(50944),ie=n(13020),re=n(6340),ae=["collateralCustody","positionCustody"];function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se={entryPrice:new C.Z(0),entryPriceText:"",entryPriceTextWithShifting:"",liquidationPrice:null,liquidationPriceText:"",liquidationPriceTextWithShifting:"",feeUsd:new C.Z(0),openFeeUsdText:"",outstandingFundingFeeUsd:null,outstandingFundingFeeUsdText:"",isNewLiquidationWorse:!1,openCloseBaseFee:null,impactFee:null,impactPct:null,impactFeeUsdText:""},ue={entryPrice:new C.Z(0),entryPriceText:"",hourlyFundingDbps:new C.Z(0),borrowFee:new C.Z(0),borrowFeeText:"",availableLiquidity:new C.Z(0),availableLiquidityText:"",maxPositionUsd:new C.Z(0),insufficientNewCollateral:!1},de=S()((function(){return Promise.all([n.e(22215),n.e(29804)]).then(n.bind(n,87015))}),{ssr:!1,loadableGenerated:{webpack:function(){return[87015]}}}),ce=function(e){var t,n=e.setPositionDirection,a=e.positionDirection,s=e.fromPairTokenInfo,m=e.toPairTokenInfo,j=(0,z.Ne)(G.yM),Z=(0,v.Os)().wallet,S=(0,I.tc)(),T=S.viewClient,oe=S.userPositions,ce=S.perpsTokens,fe=S.oraclePrices,me=S.slippage,ge=S.custodies,pe=S.poolInfo,xe=S.refreshPositionInfo,ve=S.isAnyFormSubmitting,he=S.setIsAnyFormSubmitting,we=(0,K.y)().showEditCollateralDialog,be=(0,v.Bn)(),Pe=be.connection,je=be.getTokenInfo,ye=(0,f.useRef)(""),Ce=(0,f.useState)(!0),Ze=Ce[0],Se=Ce[1],Ne=(0,f.useState)(se),Ve=Ne[0],ke=Ne[1],Le=(0,f.useState)(ue),Ie=Le[0],Fe=Le[1],_e=g("PERPS_LEVERAGE_COOKIE",I.aY.toString()),Te=(0,l.Z)(_e,2),Me=Te[0],Ue=Te[1],Oe=(0,N.cI)({defaultValues:{fromPair:G.Lr,fromPairValue:"",toPair:G.Lr,toPairValue:"",leverage:Me}}),De=Oe.control,Ee=Oe.handleSubmit,qe=Oe.watch,Ae=Oe.setValue,Be=Oe.formState,Re=qe(),He=(0,z.QY)(),We=(0,v.FB)(Re.fromPair).balance,Ge=!(0,P.Hd)(Re.fromPairValue)||new C.Z(Re.fromPairValue).gt(We),Ke=(0,v.iG)(),ze=(0,f.useMemo)((function(){var e,t=null===(e=Ke.account)||void 0===e?void 0:e.account.lamports;return!t||t<$.WO}),[Ke.account]),Ye=(0,f.useMemo)((function(){return fe?fe[m.address]:null}),[fe,m.address]),Je=(0,f.useMemo)((function(){if((0,P.Hd)(Re.toPairValue)&&Ye)return new C.Z(Re.toPairValue).mul(new C.Z(Ye))}),[Ye,Re.toPairValue]),$e=(0,ie.M)(Je),Qe=(0,f.useMemo)((function(){var e=(null===oe||void 0===oe?void 0:oe.find((function(e){return e.custody.account.mint.toString()===m.address&&e.side===a})))||null,t=ge.find((function(e){return e.account.mint.toBase58()===m.address})),n=function(){if("long"===a)return m;if("short"===a){var t;if(e)return je(e.collateralCustody.account.mint.toString());var n=ce.stableTokens.find((function(e){return e.address===s.address}));return n||(null===$e||void 0===$e||null===(t=$e[0])||void 0===t?void 0:t.tokenInfo)}}(),i=ge.find((function(e){return e.account.mint.toBase58()===(null===n||void 0===n?void 0:n.address)})),r=fe&&n&&fe[n.address]||null;return{hasExistingPosition:e,poolCustodyAccount:t,collateralTokenInfo:n,collateralCustodyAccount:i,collateralTokenPrice:r}}),[oe,ge,fe,m,a,$e,ce.stableTokens,je,s.address]),Xe=Qe.hasExistingPosition,et=Qe.poolCustodyAccount,tt=Qe.collateralTokenInfo,nt=Qe.collateralTokenPrice,it=Qe.collateralCustodyAccount,rt=(0,ie.Z)({fromPairTokenInfo:s,toPairTokenInfo:tt,fromPairValue:Re.fromPairValue}),at=rt.isLoading,ot=rt.isTokenSwapRequired,lt=rt.outAmount,st=rt.otherAmountThreshold,ut=rt.quoteResponseMeta,dt=rt.hasJupiterError,ct=rt.lastRefreshTimestamp,ft=rt.refresh;(0,D.i)({isSubmitting:Be.isSubmitting,lastRefreshTimestamp:ct,value:Number(Re.fromPairValue),refresh:ft});var mt=(0,f.useRef)(!1),gt=(0,f.useCallback)((function(e){if(mt.current=!1,(0,P.Hd)(e)){var t=tt&&nt&&Ye?ot?lt?new C.Z(lt.toString()).div(Math.pow(10,tt.decimals)).mul(nt).div(Ye):null:new C.Z(e).mul(nt).div(Ye):(ye.current=e,null);if(t&&Re.leverage){var n=new C.Z(Re.leverage).div(new C.Z(1).add(new C.Z(Re.leverage).mul(I.jV/1e4)));if(!mt.current){var i=new C.Z(t).mul(n).toDP(m.decimals).toFixed();Ae("toPairValue",i)}}else Ae("toPairValue","")}}),[tt,ot,lt,Ae,m.decimals,Ye,Re.leverage,nt]),pt=(0,f.useMemo)((function(){if(!Re.fromPairValue||!(0,P.Hd)(Re.fromPairValue)||!nt||!Je||!Ye)return!1;var e=tt&&nt&&Ye?ot?lt?new C.Z(lt.toString()).div(Math.pow(10,tt.decimals)).mul(nt).div(Ye):new C.Z(0):new C.Z(Re.fromPairValue).mul(nt).div(Ye):new C.Z(0),t=new C.Z(I.jG).div(new C.Z(1).add(new C.Z(I.jG).mul(I.jV/1e4))),n=e.mul(t).toDP(m.decimals).mul(Ye);return Je.gt(n)}),[tt,nt,ot,lt,Je,m.decimals,Ye,Re.fromPairValue]);(0,f.useEffect)((function(){tt&&nt&&Ye&&ye.current&&(gt(ye.current),ye.current="")}),[tt,nt,gt,Ye]),(0,f.useEffect)((function(){Pt(Re.leverage)}),[Ae,Re.fromPair,Re.toPair]),(0,f.useEffect)((function(){Ae("fromPair",s.address),Ae("toPair",m.address)}),[s.address,m.address,Ae]);var xt=f.useCallback((function(e){j(e,m,a),ke(se),Fe(ue),Ae("fromPairValue",""),Ae("toPairValue","")}),[a,j,Ae,m]),vt=f.useCallback((function(e){j(s,e,a),ke(se),Fe(ue),Ae("fromPairValue",""),Ae("toPairValue","")}),[j,s,a,Ae]),ht=(0,f.useCallback)((function(e){var t;e.preventDefault(),t=Re.fromPair===k.W4.toBase58()?new C.Z(We).gt($.WO)?new C.Z(We).minus($.WO).toString():"0":String(We),Ae("fromPairValue",t),gt(t)}),[Re.fromPair,Ae,gt,We]),wt=(0,f.useMemo)((function(){if(null===Z||void 0===Z||!Z.adapter.connected)return!1;if((null===s||void 0===s?void 0:s.address)!==k.W4.toBase58())return!1;if(!(0,P.Hd)(Re.fromPairValue))return!1;var e=new C.Z(We).minus($.WO);return new C.Z(Re.fromPairValue||0).gt(e)}),[We,null===s||void 0===s?void 0:s.address,null===Z||void 0===Z?void 0:Z.adapter.connected,Re.fromPairValue]),bt=Boolean(lt);(0,f.useEffect)((function(){ot&&bt&&!at&&!mt.current&&gt(Re.fromPairValue)}),[at,ot,Re.fromPairValue,bt,gt]);var Pt=(0,f.useCallback)((function(e){if(Ae("leverage",e),Ue(e),mt.current=!1,Number(Re.fromPairValue)&&Number(e)&&Ye&&tt&&nt&&!at){var t=ot&&lt?new C.Z(lt.toString()).div(Math.pow(10,tt.decimals)).mul(nt):new C.Z(Re.fromPairValue).mul(nt),n=new C.Z(e).div(new C.Z(1).add(new C.Z(e).mul(I.jV/1e4))),i=new C.Z(t).div(Ye).mul(n).toDP(m.decimals).toFixed();Ae("toPairValue",i)}else Ae("toPairValue","")}),[tt,at,ot,lt,Ae,m.decimals,Ye,Re.fromPairValue,nt,Ue]),jt=(0,f.useCallback)((function(e){if(Number(e)&&Number(Re.fromPairValue)&&Ye&&tt&&nt&&!at){mt.current=!0;var t=ot?lt?new C.Z(lt.toString()).div(Math.pow(10,tt.decimals)).mul(nt).div(Ye):null:new C.Z(Re.fromPairValue).mul(nt).div(Ye);if(t){var n=new C.Z(e).div(t).toDP(1),i=new C.Z(n).mul(new C.Z(1).add(new C.Z(n).mul(I.jV/1e4)));i.lte(I.aY)?Pt(I.aY.toString()):i.gt(I.jG)?Pt(I.jG.toString()):Ae("leverage",i.toString())}else Ae("leverage","")}else Ae("leverage","")}),[tt,at,ot,lt,Ae,Ye,Re.fromPairValue,nt,Pt]),yt=(0,P.y_)(Ye),Ct=(0,f.useCallback)((0,o.Z)(u().mark((function e(){var t,n,i,r,o,l,d,f,g,p,x,v,h,w,b,j,Z,S,N,V,k,L,I,F,_,M,U,O,D,E,q;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T&&Ye&&$e&&tt&&nt&&et&&it&&pe&&(!Xe||(null===Xe||void 0===Xe?void 0:Xe.custody.account.mint.toString())===m.address)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n=null!==Xe&&void 0!==Xe&&null!==(t=Xe.accounting)&&void 0!==t&&t.fundingFeeUsd?new C.Z(Xe.accounting.fundingFeeUsd).div(1e6):null,i=n?"".concat(H.uf.format(n,yt)," USD"):"",r=function(){var e;if(null!==Xe&&void 0!==Xe&&null!==(e=Xe.accounting)&&void 0!==e&&e.fundingFeeUsd){var t=new C.Z(Xe.accounting.fundingFeeUsd),n=new C.Z(Ye).mul(1e6).toDP(0);return new(y())(t.div(n).mul(Math.pow(10,tt.decimals)).toDP(0).toString())}return new(y())(0)}(),o=Re.fromPairValue?ot?lt?new(y())(new C.Z(lt.toString()).toFixed(0)):new(y())(0):new(y())(new C.Z(Re.fromPairValue).mul(Math.pow(10,s.decimals)).toFixed(0)):"long"===a?new(y())(new C.Z(.9).div(Ye).mul(Math.pow(10,m.decimals)).toFixed(0)):new(y())(9e5),l=(0,P.Hd)(Re.toPairValue)?new(y())(new C.Z(Re.toPairValue).mul(Ye).mul(1e6).toDP(0).toFixed(0)):new(y())(1e6),e.next=10,T.getIncreasePosition({collateral:o,sizeUsdDelta:l,side:a,custody:et,positionAccount:Xe,collateralCustody:it,collateralTokenPrice:nt.toNumber(),pool:pe.pool,tokenPrice:Ye.toNumber()});case 10:if(d=e.sent){e.next=13;break}return e.abrupt("return");case 13:f=Ye?Ye.toDP(4):new C.Z(0),g="$"+H.uf.format(f,yt),p=f?Re.fromPairValue&&Xe&&Xe.sizeUsd.gt(0)&&d.price.gtn(0)?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("span",{children:["$",H.uf.format(new C.Z(Xe.price.toString()).div(1e6),yt)]}),(0,A.jsx)("br",{className:"block lg:hidden"}),(0,A.jsx)("span",{children:" \u2192 "}),(0,A.jsxs)("span",{children:["$",H.uf.format(new C.Z(d.price.toString()).div(1e6),yt)]})]}):g:"",x=(0,P.Hd)(Re.fromPairValue)&&d.liquidationPrice?new C.Z((0,P.lt)(d.liquidationPrice,6)).toDP(4):null,v=null!==x&&void 0!==x&&x.gt(0)?"$"+H.uf.format(x,yt):"-",h=!1,w=function(){if(!f)return"";if(!Re.fromPairValue)return v;if(null!==Xe&&void 0!==Xe&&Xe.accounting){var e=new C.Z(Xe.accounting.liquidationPrice.toString());return h="long"===a?new C.Z(d.liquidationPrice.toString()).gt(e):new C.Z(d.liquidationPrice.toString()).lt(e),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("span",{children:["$",H.uf.format(new C.Z(e.toString()).div(1e6),yt)]}),(0,A.jsx)("br",{className:"block lg:hidden"}),(0,A.jsx)("span",{children:" \u2192 "}),(0,A.jsxs)("span",{children:["$",H.uf.format(new C.Z(d.liquidationPrice.toString()).div(1e6),yt)]})]})}return v}(),b=(0,P.Hd)(Re.fromPairValue)?new C.Z(d.feeUsd.toString()).div(1e6).minus(n||0):null,j=(0,P.y_)(b),Z=new C.Z(l.toString()).div(1e6).mul(pe.pool.fees.increasePositionBps.toString()).div(1e4),S=Z&&Z.gt(1e-6)?"".concat(H.uf.format(Z,j)," USD"):"-",N=new C.Z(it.account.assets.owned.toString()).sub(it.account.assets.locked.toString()).mul(new C.Z(nt)).div(new C.Z(10).pow(tt.decimals)),V="long"===a?new C.Z(et.account.pricing.maxGlobalLongSizes.toString()).minus(et.account.assets.guaranteedUsd.toString()).div(1e6):new C.Z(et.account.pricing.maxGlobalShortSizes.toString()).minus(et.account.assets.globalShortSizes.toString()).div(1e6),k=pe.maxPositionUsd.gt(0)?pe.maxPositionUsd.minus(Xe?Xe.sizeUsd.div(1e6):0):new C.Z(Number.MAX_VALUE),L=C.Z.min(N,V,k),I=L?"$"+H.uf.format(C.Z.max(L,0),yt):"",F=it.account.assets.owned.gtn(0)&&it.account.assets.locked.gtn(0)?new C.Z(it.account.assets.locked.toString()).div(it.account.assets.owned.toString()):new C.Z(0),_=new C.Z(it.account.fundingRateState.hourlyFundingDbps.toString()),M=new C.Z(_.div(1e3)).mul(F),U=c.ag._({id:"yZ/Flv",values:{0:M.toDP(4).toString()}}),O=Je?Je.mul(pe.pool.fees.increasePositionBps.toString()).div(J.TL.toString()):null,D=b&&O?C.Z.max(0,b.minus(O||0)):null,E=D&&Je?D.div(Je).mul(100):null,q=D?"".concat(H.uf.format(D,j)," USD"):"-",ke({entryPrice:f,entryPriceText:g,entryPriceTextWithShifting:p,liquidationPrice:x,liquidationPriceText:v,liquidationPriceTextWithShifting:w,feeUsd:b,openFeeUsdText:S,outstandingFundingFeeUsd:n,outstandingFundingFeeUsdText:i,isNewLiquidationWorse:h,openCloseBaseFee:O,impactFee:D,impactPct:E,impactFeeUsdText:q}),Fe({entryPrice:f,entryPriceText:g,hourlyFundingDbps:_,borrowFee:M,borrowFeeText:U,availableLiquidity:L,availableLiquidityText:I,maxPositionUsd:k,insufficientNewCollateral:o.lt(r)}),e.next=44;break;case 41:e.prev=41,e.t0=e.catch(2),console.log("Tradepage:",e.t0);case 44:return e.prev=44,Se(!1),e.finish(44);case 47:case"end":return e.stop()}}),e,null,[[2,41,44,47]])}))),[it,tt,nt,s.decimals,Xe,ot,lt,et,pe,a,yt,Je,$e,m.address,m.decimals,Ye,T,Re.fromPairValue,Re.toPairValue]),Zt=(0,b.Fm)(),St=(0,f.useState)(""),Nt=St[0],Vt=St[1];(0,p.Z)((function(){var e;Vt([Re.fromPairValue,Re.toPairValue,Re.leverage,a.toString(),null===Ye||void 0===Ye?void 0:Ye.toString(),null===oe||void 0===oe||null===(e=oe.map((function(e){return e.publicKey.toString()})))||void 0===e?void 0:e.join(",")].join(""))}),500,[Re.fromPairValue,Re.toPairValue,Re.leverage,a.toString(),null===Ye||void 0===Ye?void 0:Ye.toString(),null===oe||void 0===oe||null===(t=oe.map((function(e){return e.publicKey.toString()})))||void 0===t?void 0:t.join(",")]),(0,Q.a)(["perps-fetchViews",Nt],(0,o.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ct();case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}}),e)}))),{enabled:Boolean(T)&&Zt,refetchInterval:5e3,refetchIntervalInBackground:!1,keepPreviousData:!0,retry:!0,retryDelay:2e3}),(0,f.useEffect)((function(){Se(!0)}),[s,m,Re.fromPairValue,Re.leverage,a]);var kt=(0,f.useMemo)((function(){if(Je&&!Ie.maxPositionUsd.eq(0))return Je.gt(Ie.maxPositionUsd)}),[Ie.maxPositionUsd,Je]),Lt=(0,f.useMemo)((function(){if(Ye&&(0,P.Hd)(Re.toPairValue)&&Je&&!Ie.availableLiquidity.eq(0))return Je.gt(Ie.availableLiquidity)}),[Ie.availableLiquidity,Je,Ye,Re.toPairValue]),It=(0,f.useMemo)((function(){if((0,P.Hd)(Re.leverage))return Number(Re.leverage)<I.aY}),[Re.leverage]),Ft=(0,f.useMemo)((function(){if((0,P.Hd)(Re.fromPairValue)&&tt&&nt&&Ye)return ot?lt?new C.Z(lt.toString()).div(Math.pow(10,tt.decimals)).mul(nt):null:new C.Z(Re.fromPairValue).mul(nt)}),[tt,nt,ot,lt,Ye,Re.fromPairValue]),_t=(0,f.useMemo)((function(){if((0,P.Hd)(Re.fromPairValue)&&tt&&Ye&&Ft)return new C.Z(Ft.toFixed(4)).lt(I.IH)}),[Re.fromPairValue,tt,Ye,Ft]),Tt=(0,f.useMemo)((function(){return(null===Je||void 0===Je?void 0:Je.gt(0))&&!$e}),[Je,$e]),Mt=(0,f.useMemo)((function(){return Ie.availableLiquidity.lte(0)}),[Ie.availableLiquidity]),Ut=(0,f.useMemo)((function(){return!Re.fromPairValue||!Re.toPairValue||Ze||Mt||ze||Ge||Be.isSubmitting||Lt||kt||It||_t||Tt||wt||Boolean(dt)||ve||pt}),[_t,Lt,kt,Be.isSubmitting,dt,Mt,Tt,ve,pt,It,Ge,ze,Ze,wt,Re.fromPairValue,Re.toPairValue]),Ot=f.useMemo((function(){if(!Re.fromPairValue)return"long"===a?c.ag._({id:"TTLNNf"}):c.ag._({id:"a1cu2k"});if(Mt||Ze)return c.ag._({id:"Z3FXyt"});if(Re.fromPairValue){if(pt)return c.ag._({id:"NJCqJ8"});if(It)return c.ag._({id:"/Ard9t",values:{MINIMUM_LEVERAGE:I.aY}});if(kt||Lt)return Ie.maxPositionUsd.gt(Ie.availableLiquidity)?c.ag._({id:"ym7E6o"}):c.ag._({id:"z72rfx"});if(Ge||ze)return c.ag._({id:"UsQ5AM",values:{0:ze?"SOL":s.symbol}});if(_t)return c.ag._({id:"xLIKZf",values:{MINIMUM_COLLATERAL_SIZE_USD:I.IH}});if(Tt)return c.ag._({id:"vVDsjZ"});if(wt)return c.ag._({id:"GyFBKR"});if(Be.isSubmitting)return(0,A.jsxs)("span",{className:"flex items-center justify-center",children:[(0,A.jsx)(V.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,A.jsx)("div",{className:"mr-2"}),Be.isSubmitting?c.ag._({id:"K5IplD"}):c.ag._({id:"yQE2r9"})]})}return"long"===a?c.ag._({id:"DtCIPl",values:{0:m.symbol}}):c.ag._({id:"5Ad+Jc",values:{0:m.symbol}})}),[_t,Lt,kt,Be.isSubmitting,s.symbol,Mt,Tt,pt,It,Ge,ze,Ze,wt,a,Ie.availableLiquidity,Ie.maxPositionUsd,m.symbol,Re.fromPairValue]),Dt=(0,re.Z)().promptKeeperOpenPositionNotification,Et=f.useCallback(function(){var e=(0,o.Z)(u().mark((function e(t){var n,i,l,d,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ut&&Ye&&Z&&Z.adapter.publicKey&&T&&it&&et){e.next=2;break}return e.abrupt("return");case 2:return he(!0),n="long"===a?new(y())(new C.Z(Ye).mul(1e6).mul(100+me).div(100).round().toFixed()):new(y())(new C.Z(Ye).mul(1e6).mul(100-me).div(100).round().toFixed()),i={side:a,collateralCustody:it,positionCustody:et,inputMint:new _.PublicKey(s.address),priceSlippage:n,collateralTokenDelta:new(y())(new C.Z(t.fromPairValue).mul(Math.pow(10,s.decimals)).toDP(0).toFixed()),sizeUsdDelta:new(y())(new C.Z(t.toPairValue).mul(Ye).mul(1e6).round().toFixed()),jupiterMinimumOut:ot&&st?new(y())(st.toString()):null},e.prev=5,e.next=8,(0,Y.w)(le({wallet:Z,connection:Pe},i));case 8:if(l=e.sent,d=l.instructions,c=l.positionRequestKey,d.length){e.next=13;break}throw new Error("Failed to create transaction");case 13:return e.next=15,new Promise(function(){var e=(0,o.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dt(d,c,(function(){xe(),t(!0)}),n,function(){var e=i.collateralCustody,t=i.positionCustody,n=(0,r.Z)(i,ae);return le({wallet:Z.adapter.name,collateralCustody:e.publicKey.toString(),positionCustody:t.publicKey.toString()},(0,te.w_)(n))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 15:return e.abrupt("return",e.sent);case 18:e.prev=18,e.t0=e.catch(5),console.log("Failed to open position!",e.t0);case 21:return e.prev=21,he(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[5,18,21,24]])})));return function(t){return e.apply(this,arguments)}}(),[it,Pe,s.address,s.decimals,Ut,ot,st,et,a,Dt,xe,he,me,Ye,T,Z]);(0,q.Gl)(at||!ot||null===ut||void 0===ut?void 0:ut.quoteResponse,s.address,(null===tt||void 0===tt?void 0:tt.address)||"");var qt=(0,E.Z)({selectedRoute:ut,hasEnoughSOL:!ze}).errors,At=(0,f.useMemo)((function(){var e=[];return wt&&e.push(c.ag._({id:"p6yX1j",values:{MINIMUM_SOL_BALANCE:$.WO}})),e}),[wt]);(0,f.useEffect)((function(){ke(se),Fe(ue)}),[a]);var Bt=(0,f.useCallback)((function(){var e=new C.Z(Re.leverage).sub(.1).toDP(1);e.lte(I.aY)||Pt(e.toString())}),[Pt,Re.leverage]),Rt=(0,f.useCallback)((function(){var e=new C.Z(Re.leverage).add(.1).toDP(1);e.gte(I.jG)||Pt(e.toString())}),[Pt,Re.leverage]),Ht=(0,f.useCallback)((function(){if(Ie.availableLiquidity&&Ye){var e=new C.Z(Ie.availableLiquidity).div(Ye).mul(.995).toString();Ae("toPairValue",e),jt(e)}}),[jt,Ie.availableLiquidity,Ae,Ye]),Wt=(0,v.C9)();return(0,A.jsx)(A.Fragment,{children:(0,A.jsxs)("form",{onSubmit:Ee(Et),className:"flex lg:flex-col",children:[(0,A.jsxs)("div",{className:"flex !w-[calc(100%-110px)] flex-col justify-between bg-v2-background lg:!w-full",children:[(0,A.jsxs)("div",{className:"flex h-[52px] flex-row items-center justify-between space-x-1 px-2 lg:h-[56px] lg:space-x-4 lg:px-4",children:[(0,A.jsxs)("div",{className:"flex items-center rounded-full bg-v2-background-dark",children:[(0,A.jsxs)("button",{type:"button",onClick:function(){return n("long")},disabled:ve,className:(0,x.cn)("h-7 w-[70px] lg:h-auto lg:w-20","flex flex-row items-center justify-center space-x-2 rounded-full border-2 border-transparent fill-current font-semibold text-white/50","px-2 py-1 lg:m-1","long"===a?"!border-perps-green bg-perps-green/10 !text-perps-green":"",{"cursor-not-allowed opacity-50":ve&&"long"!==a}),children:[(0,A.jsx)("span",{className:"text-xs leading-none lg:text-sm",children:c.ag._({id:"otaTjg"})}),(0,A.jsx)(R,{fill:"inherit",className:"hidden lg:block"})]}),(0,A.jsxs)("button",{type:"button",onClick:function(){return n("short")},disabled:ve,className:(0,x.cn)("h-7 w-[70px] lg:h-auto lg:w-20","flex flex-row items-center justify-center space-x-2 rounded-full border-2 border-transparent fill-current font-semibold text-white/50","px-2 py-1 lg:m-1","short"===a?"!border-perps-red bg-perps-red/10 !text-perps-red":"",{"cursor-not-allowed opacity-50":ve&&"short"!==a}),children:[(0,A.jsx)("span",{className:"text-xs leading-none lg:text-sm",children:c.ag._({id:"RRXpo1"})}),(0,A.jsx)(B,{fill:"inherit",className:"hidden lg:block"})]})]}),(0,A.jsx)("div",{className:"flex h-7 items-center",children:(0,A.jsx)(W.Z,{isLoading:at,refresh:function(){Se(!0),Wt([s.address,(null===tt||void 0===tt?void 0:tt.address)||m.address]),ft()}})})]}),(0,A.jsxs)("div",{className:"mt-1",children:[(0,A.jsxs)("div",{className:"flex flex-row justify-between px-2 text-xs font-[500] text-white lg:px-4",children:[(0,A.jsx)("p",{children:(0,A.jsx)(d.cC,{id:"UFFIym"})}),(0,A.jsxs)("div",{onClick:ht,className:"flex cursor-pointer flex-row items-center space-x-2 fill-current text-white/25",children:[(0,A.jsx)(L.Z,{width:10,height:10}),(0,A.jsx)(X.Z,{mintAddress:s.address})]})]}),(0,A.jsx)("div",{className:"px-2",children:(0,A.jsx)("div",{className:(0,x.cn)("relative h-14 rounded-xl bg-v2-background-dark","mt-1 py-2 pl-3 pr-2","lg:mt-3 lg:p-4"),children:(0,A.jsx)(w.Z,{control:De,pair:s,pairName:"fromPairValue",onSubmit:xt,mintsList:He,modalId:"PAIRS_SELECT_FROM_PAIR_MODAL_ID",onChangeWithoutEffect:gt,disableTokenSelect:ve,disabled:ve})})}),(0,A.jsx)("div",{className:"px-2",children:[].concat((0,i.Z)(qt),[dt],(0,i.Z)(At)).filter(Boolean).length>0&&(0,A.jsx)("div",{className:"mt-2 rounded-lg bg-jupiter-red px-3 py-2 text-xs text-white",children:[].concat((0,i.Z)(qt),[dt],(0,i.Z)(At)).filter(Boolean).map((function(e){return(0,A.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,A.jsx)(O.Z,{}),(0,A.jsx)("span",{children:e})]},e)}))})}),(0,A.jsx)("div",{className:"mt-2 flex flex-row px-2 text-xs font-[500] text-white lg:px-4",children:(0,A.jsx)(d.cC,{id:"Z5U7bd",values:{0:"long"===a?"Long":"Short"},components:{0:(0,A.jsx)("span",{}),1:(0,A.jsx)("span",{className:"ml-0.5"})}})}),(0,A.jsx)("div",{className:"px-2 lg:px-3",children:(0,A.jsx)("div",{className:(0,x.cn)("relative rounded-xl bg-v2-background-dark","mt-1 p-2 py-3","lg:mt-3 lg:p-4"),children:(0,A.jsx)(w.Z,{disableTokenSelect:!0,control:De,pair:m,pairName:"toPairValue",onSubmit:vt,mintsList:(0,f.useMemo)((function(){return ce.nonStableTokens.map((function(e){return e.address}))}),[ce]),modalId:"PAIRS_SELECT_TO_PAIR_MODAL_ID",onChangeWithoutEffect:jt,hideUSDValue:!0,disabled:ve})})}),(0,A.jsxs)("div",{className:"mt-2 h-auto w-full items-center justify-between px-2 lg:px-4",children:[(0,A.jsx)("span",{className:"text-xs",children:c.ag._({id:"Ke6k18"})}),(0,A.jsxs)("div",{className:"relative mt-2 flex !h-[38px] w-full items-center justify-center rounded-xl bg-black/50 p-3 lg:!h-[56px]",children:[(0,A.jsx)("button",{type:"button",onClick:Bt,disabled:ve,className:"absolute left-2.5 top-1 px-1 text-lg text-v2-lily/75 lg:p-2",children:"-"}),(0,A.jsx)(N.Qr,{name:"leverage",control:De,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,A.jsx)(ee.Z,{decimals:1,onChange:function(e){return n(e.floatValue)},value:i,disabled:ve,className:"!lg:text-sm h-full w-full !text-center !text-xs font-semibold text-white disabled:!text-white",onChangeWithoutEffect:function(e){return Pt(e.split("x")[0])},customWithValueLimit:function(e){return!!e&&e<=I.jG},suffix:"x"})}}),(0,A.jsx)("button",{type:"button",onClick:Rt,disabled:ve,className:"absolute right-2.5 top-1 px-1 text-lg text-v2-lily/75 lg:p-2",children:"+"})]})]}),(0,A.jsx)("div",{className:"flex w-full flex-row pt-4",children:(0,A.jsx)(de,{value:Number(Re.leverage),setValue:function(e){Ae("leverage",String(e)),Pt(String(e))},activeColors:"long"===a?"#32DF7B":"#EB5757",borderColor:"long"===a?"#28A95E":"#B53B3B",disabled:ve,className:"px-4 lg:px-6"})}),(0,A.jsxs)("div",{className:"border-t border-t-black/10 px-2 lg:px-4 lg:pt-4",children:[(0,A.jsx)("div",{className:"hidden lg:block",children:(0,A.jsx)(ne.Y8,{collateralInput:Ft,orderInfoLoading:Ze})}),(0,A.jsx)("div",{className:"hidden lg:block",children:(0,A.jsx)(ne.zu,{sizeUsd:Je,collateralInput:Ft,orderInfoLoading:Ze})}),kt||Lt?(0,A.jsx)(U.Z,{iconSize:14,className:"rounded-lg bg-jupiter-primary/5 !p-2 !text-jupiter-primary",message:(0,A.jsxs)("div",{children:[Ie.maxPositionUsd.gt(Ie.availableLiquidity)?(0,A.jsx)("p",{children:c.ag._({id:"SlfdBH",values:{0:H.uf.format(Ie.availableLiquidity,0)}})}):(0,A.jsx)("p",{children:c.ag._({id:"Q+LWOM",values:{0:H.uf.format(Ie.maxPositionUsd,0)}})}),(0,A.jsx)("p",{onClick:Ht,className:"cursor-pointer underline",children:c.ag._({id:"V5jUiY"})})]})}):null,Xe&&Ie.insufficientNewCollateral&&Ve.isNewLiquidationWorse?(0,A.jsx)(U.Z,{iconSize:14,className:"rounded-lg bg-warning/10 !p-2 !text-warning",message:(0,A.jsx)(d.cC,{id:"AeOslw",values:{0:Ve.outstandingFundingFeeUsdText},components:{0:(0,A.jsx)("p",{}),1:(0,A.jsx)("button",{type:"button",className:"underline decoration-warning decoration-dashed decoration-1 underline-offset-[3px]",onClick:function(){return we({positionAccountPubkey:Xe.publicKey})}})}})}):null]}),(0,A.jsxs)("div",{className:"mt-3 px-2 pb-4 lg:px-4",children:[null!==Z&&void 0!==Z&&Z.adapter.publicKey?(0,A.jsx)("button",{type:"submit",className:(0,x.cn)("w-full items-center rounded-lg border-none p-px font-semibold",{"bg-perps-green text-[#155530] hover:bg-opacity-80":"long"===a,"bg-perps-red text-[#371111] hover:bg-opacity-80":"short"===a,"cursor-not-allowed opacity-50":Ut}),disabled:Ut,children:(0,A.jsx)("div",{className:(0,x.cn)("flex items-center justify-center rounded-lg","lg:px-8 lg:py-4","p-3"),children:(0,A.jsx)("span",{className:"text-center",children:Ot})})}):(0,A.jsx)(F.uS,{buttonClassName:"w-full !bg-transparent",overrideContent:(0,A.jsx)(h.Z,{className:"w-full",size:"md",children:(0,A.jsx)("span",{children:(0,A.jsx)(d.cC,{id:"CtByM7"})})})}),(0,A.jsx)(M(),{href:G.GJ,target:"_blank",className:"mt-4 flex cursor-pointer justify-center text-xxs text-v2-lily/80 underline",children:(0,A.jsx)(d.cC,{id:"f4S31m"})})]})]})]}),(0,A.jsx)(ne.ZP,{positionDirection:a,positionInfo:Ie,toPairTokenInfo:m,orderInfo:Ve,orderInfoLoading:Ze,collateralInput:Ft,sizeUsd:Je,pool:null===pe||void 0===pe?void 0:pe.pool})]})})}},3561:function(e,t,n){n(93981);var i=n(29541);t.Z=function(e){var t=e.fill,n=void 0===t?"white":t,r=e.width,a=void 0===r?12:r,o=e.height,l=void 0===o?12:o;return(0,i.jsxs)("svg",{width:a,height:l,viewBox:"0 0 12 12",fill:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("g",{clipPath:"url(#clip0_9115_125056)",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6C12 9.31371 9.31371 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C9.31371 0 12 2.68629 12 6ZM5.95362 7.63052C5.60347 7.63083 5.31644 7.35363 5.30407 7.0038L5.15183 2.7132C5.14549 2.53686 5.21146 2.36591 5.33389 2.23905C5.45631 2.11218 5.62504 2.04082 5.80138 2.04082H6.10586C6.2822 2.04082 6.45093 2.11218 6.57336 2.23905C6.69578 2.36591 6.76175 2.53686 6.75541 2.7132L6.60317 7.0038C6.5908 7.35363 6.30377 7.63083 5.95362 7.63052ZM5.95352 10.0669C6.45812 10.0669 6.86694 9.65807 6.86694 9.15347C6.86694 8.64887 6.45812 8.24004 5.95352 8.24004C5.44891 8.24004 5.04009 8.64887 5.04009 9.15347C5.04009 9.65807 5.44891 10.0669 5.95352 10.0669Z",fill:n})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_9115_125056",children:(0,i.jsx)("rect",{width:"12",height:"12",fill:n})})})]})}}}]);
//# sourceMappingURL=23439.6d08b94f9f4c9901.js.map